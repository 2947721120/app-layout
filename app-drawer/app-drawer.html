<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../polymer/polymer.html">

<!--
app-drawer is a navigation drawer that can slide in from the left or right.

Example:

Add a drawer on the left side of the screen (default):

```html
<app-drawer opened></app-drawer>
```

Add a drawer on the right side of the screen:

```html
<app-drawer position="right" opened></app-drawer>
```

### Styling

Custom property                         | Description                            | Default
----------------------------------------|----------------------------------------|---------
`--app-drawer-duration`                 | The duration of the transition         | 0.2s
`--app-drawer-timing-function`          | The timing function of the transition  | ease

@demo app-drawer/demo.html
-->

<dom-module id="app-drawer">

  <style>

    :host {
      position: absolute;
      top: 0;
      right: auto;
      bottom: 0;
      left: 0;
      width: 256px;
      overflow: hidden;

      -webkit-transform: translate(-100%, 0);
      transform: translate(-100%, 0);

      -webkit-transition-property: -webkit-transform;
      transition-property: transform;

      -webkit-transition-duration: var(--app-drawer-duration, 0.2s);
      transition-duration: var(--app-drawer-duration, 0.2s);

      -webkit-transition-timing-function: var(--app-drawer-timing-function, ease);
      transition-timing-function: var(--app-drawer-timing-function, ease);
    }

    :host([position=right]) {
      right: 0;
      left: auto;
      -webkit-transform: translate(100%, 0);
      transform: translate(100%, 0);
    }

    :host([opened]),
    :host([position][opened]) {
      -webkit-transition-property: -webkit-transform;
      transition-property: transform;

      -webkit-transform: translate(0, 0);
      transform:  translate(0, 0);
    }

  </style>

  <template>

    <content></content>

  </template>

  <script>

    Polymer({

      is: 'app-drawer',

      properties: {

        /**
         * The opened state of the drawer.
         */
        opened: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true
        },

        /**
         * The drawer does not close when tapped or swiped.
         */
        sticky: {
          type: Boolean,
          value: false,
          notify: true,
          reflectToAttribute: true
        },

        /**
         * Determinates the position of the drawer on the screen.
         * Options are left, right, top, bottom.
         */
        position: {
          type: String,
          value: 'left',
          reflectToAttribute: true
        },

        __lastTrackDirection: Number

      },

      listeners: {
        tap: '__tapHandler',
        track: '__trackHandler'
      },

      /**
       * Toggles the drawer in and out.
       *
       * @method toggle
       */
      toggle: function() {
        this.opened = !this.opened;
      },

      __tapHandler: function() {
        if (!this.sticky) {
          this.opened = false;
        }
      },

      __trackHandler: function(event) {
        if (!this.sticky) {
          switch (event.detail.state) {
            case 'start':
              this.style.transitionDuration = this.style.webkitTransitionDuration = '0s';
              break;

            case 'track':
              switch (this.position) {
                case 'left':
                  this.transform('translate(' + Math.min(0, event.detail.dx) + 'px, 0)');
                  break;
                case 'right':
                  this.transform('translate(' + Math.max(0, event.detail.dx) + 'px, 0)');
                  break;
              }
              if (Math.abs(event.detail.ddx) > 0) {
                this.__lastTrackDirection = event.detail.ddx;
              }
              break;

            case 'end':
              this.style.transitionDuration = this.style.webkitTransitionDuration = '';
              this.transform('');
              this.opened = (this.position === 'left' && this.__lastTrackDirection > 0) ||
                (this.position === 'right' && this.__lastTrackDirection < 0);
              break;
          }
        }
      }

    });

  </script>

</dom-module>
